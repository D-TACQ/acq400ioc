
# Internal clock: with full feedback

record (longout, "${UUT}:${SITE}:INTCLK_HZ") {
	field(DTYP, "Soft Channel")
	field(PINI, "YES")
	field(VAL,  "500000")
	field(DESC, "Internal FCLK [Hz]")
	field(LOPR, "10000")
	field(HOPR, "1000000")
	field(FLNK, "${UUT}:${SITE}:INTCLK_calc")
	field(EGU,  "Hz")
	field(DISV, "1")
	field(SDIS, "${UUT}:${SITE}:CLK")                
}

record(longout, "${UUT}:${SITE}:LO"){
	field(DTYP, "Soft Channel")
	field(VAL,  "${LO}")
	field(FLNK, "${UUT}:${SITE}:INTCLK_calc")
	field(DESCR, "Local Oscillator")
}
record (calc, "${UUT}:${SITE}:INTCLK_calc") {
	field(INPA, "${UUT}:${SITE}:LO")
	field(INPB, "${UUT}:${SITE}:INTCLK_HZ")
	field(CALC, "A/B")
	field(PREC, "0")
	field(DESC, "calculates INTCLK clkdiv")
	field(FLNK, "${UUT}:${SITE}:clkdiv:i")
	field(DISV, "1")
	field(SDIS, "${UUT}:${SITE}:INTCLK_calc:r.PACT")
}

record (longout, "${UUT}:${SITE}:clkdiv:i") {
	field(DTYP, "longoutAcqHost")
	field(DOL,  "${UUT}:${SITE}:INTCLK_calc")
	field(OUT, "@/dev/acq420.${SITE}.knobs/clkdiv")
	field(OMSL, "closed_loop")
	field(DISV, "1")
	field(SDIS, "${UUT}:${SITE}:CLK")	
}

record (longin, "${UUT}:${SITE}:clkdiv:r") {
	field(DTYP, "longinAcqHost")
	field(INP, "@/dev/acq420.${SITE}.knobs/clkdiv")
	field(SCAN, "1 second")
	field(PINI, "YES")
	field(FLNK, "${UUT}:${SITE}:INTCLK_calc:r")		
}

record (calcout, "${UUT}:${SITE}:INTCLK_calc:r") {
	field(INPA, "${UUT}:${SITE}:LO")
	field(INPB, "${UUT}:${SITE}:clkdiv:r")
	field(CALC, "A/B")
	field(PREC, "0")
	field(DESC, "calculates INTCLK clkdiv")
	field(OUT, "${UUT}:${SITE}:INTCLK_HZ PP")
	field(OOPT, "On Change")
	field(DISV, "1")
	field(SDIS, "${UUT}:${SITE}:CLK")		
}

# Clkdiv with external clock - go direct.

record (longout, "${UUT}:${SITE}:clkdiv") {
	field(DTYP, "Soft Channel")	
	field(FLNK, "${UUT}:${SITE}:clkdiv:e")
    field(LOPR, "1")
    field(HOPR, "65535")	
}

record (longout, "${UUT}:${SITE}:clkdiv:e") {
	field(DTYP, "longoutAcqHost")
	field(DOL,  "${UUT}:${SITE}:clkdiv")
	field(OUT, "@/dev/acq420.${SITE}.knobs/clkdiv")
	field(OMSL, "closed_loop")
	field(DISV, "0")
	field(SDIS, "${UUT}:${SITE}:CLK")	
}


record(bo, "${UUT}:${SITE}:simulate") {
	field(DTYP, "boAcqHost")
	field(OUT, "@/dev/acq420.${SITE}.knobs/simulate")
}

record(stringin, "${UUT}:${SITE}:stats") {
	field(DTYP, "dsSysfsStringin")
	field(INP, "@/dev/acq420.${SITE}.knobs/stats")
}

record(bo, "${UUT}:${SITE}:data32") {
	field(DTYP, "boAcqHost")
	field(OUT,  "@/dev/acq420.${SITE}.knobs/data32")
	field(PINI, "YES")
	field(DESC, "select 32 bit data packing")
}

record(mbbo, "${UUT}:${SITE}:SIG:clk_counter_src")
{
	field(DTYP,	"mbboAcqHost")
	field(OUT,  "@/dev/acq420.${SITE}.knobs/clk_counter_src")
	field(NOBT, "4")
	field(PINI, "YES")
	field(ZRST, "DIV")
	field(EIST, "d0")	
	field(NIST, "d1")
	field(TEST, "d2")
	field(ELST, "d3")
	field(TVST, "d4")
	field(TTST, "d5")
	field(FTST, "d6")
	field(FFST, "d7")
}

