# wr11.db : WR site 11 functions


record(stringin, "${UUT}:${SITE}:Si5326:TUNEPHASE:STATUS")
{
	field(DTYP, "stream")
	field(INP,  "@wr.proto getSi5326TP_STATE ${SPORT}")
	field(SCAN, "1 second")
}

record(stringin, "${UUT}:${SITE}:Si5326:TUNEPHASE:STATE")
{
	field(DTYP, "stream")
	field(INP,  "@wr.proto getSi5326TP_STATE_VALUE ${SPORT}")
	field(SCAN, "I/O Intr")
}

record(bi, "${UUT}:${SITE}:Si5326:TUNEPHASE:OK:r")
{
	field(DTYP, "stream")
	field(INP,  "@wr.proto getSi5326TP_OK ${SPORT}")
	field(SCAN, "I/O Intr")
	field(ZNAM, "0")
	field(ONAM, "1")
	field(FLNK, "${UUT}:${SITE}:Si5326:TUNEPHASE:OK")
}

record(longin, "${UUT}:0:WR:PPS:LOS") {
	field(FLNK, "${UUT}:${SITE}:Si5326:TUNEPHASE:OK")
}

record(calc, "${UUT}:${SITE}:Si5326:TUNEPHASE:OK")
{
	field(INPA, "${UUT}:${SITE}:Si5326:TUNEPHASE:OK:r")
	field(INPB, "${UUT}:0:WR:PPS:LOS")
	field(CALC, "A && (!B)")
}


record(bi, "${UUT}:${SITE}:Si5326:TUNEPHASE:BUSY")
{
	field(DTYP, "stream")
	field(INP,  "@wr.proto getSi5326TP_BUSY ${SPORT}")
	field(SCAN, "I/O Intr")
	field(ZNAM, "0")
	field(ONAM, "1")	
}

record(longin, "${UUT}:${SITE}:Si5326:TUNEPHASE:BUSY:STEP")
{
	field(DTYP, "stream")
	field(INP,  "@wr.proto getSi5326TP_BUSY_STEP ${SPORT}")
	field(SCAN, "I/O Intr")
	field(FLNK, "${UUT}:${SITE}:Si5326:TUNEPHASE:BUSY:ACT")
}

record(calc, "${UUT}:${SITE}:Si5326:TUNEPHASE:BUSY:ACT")
{
	field(INPA, "${UUT}:${SITE}:Si5326:TUNEPHASE:BUSY:STEP")
	field(INPB, "${UUT}:${SITE}:Si5326:TUNEPHASE:BUSY")
	field(CALC, "B && (A&1)")
}


record(bo, "${UUT}:${SITE}:Si5326:TUNEPHASE")
{
	field(DTYP, "stream")
	field(OUT,  "@wr.proto setSi5326TP ${SPORT}")
}

record(bo, "${UUT}:${SITE}:WRTD_TXI")
{
	field(DTYP, "stream")
	field(OUT,  "@wr.proto set_wrtd_txi ${SPORT}")
	field(ZNAM, "1")
	field(ONAM, "0")
}

record(stringout, "${UUT}:${SITE}:WRTD_TXI_ID")
{
	field(DTYP, "stream")
	field(OUT,  "@wr.proto set_wrtd_txi_id ${SPORT}")	
}

record(bo, "${UUT}:${SITE}:SFP_TX_DISABLE") {
	field(DTYP, "Soft Channel")
	field(ONAM, "1")
	field(ZNAM, "0")

	field(FLNK, "${UUT}:${SITE}:SFP_TX_DISABLE:w")
}

record(bo, "${UUT}:${SITE}:SFP_TX_DISABLE:w") {
	field(DTYP, "stream")
	field(OUT,  "@wr.proto setSfpTxDisable ${SPORT}")	
	field(DISV, "1")
	field(SDIS, "${UUT}:${SITE}:SFP_TX_DISABLE:s.PACT")
	field(DOL,  "${UUT}:${SITE}:SFP_TX_DISABLE PP")
	field(OMSL, "closed_loop")	
}

record(bi, "${UUT}:${SITE}:SFP_TX_DISABLE:r") {
	field(DTYP, "stream")
	field(INP,  "@wr.proto getSfpTxDisable ${SPORT}")
	field(SCAN, "5 second")
	field(FLNK, "${UUT}:${SITE}:SFP_TX_DISABLE:s")
}

record(bo, "${UUT}:${SITE}:SFP_TX_DISABLE:s") {
	field(DTYP, "Soft Channel")
	field(DOL,  "${UUT}:${SITE}:SFP_TX_DISABLE:r NPP")
	field(OMSL, "closed_loop")
	field(OUT,  "${UUT}:${SITE}:SFP_TX_DISABLE PP")
}


