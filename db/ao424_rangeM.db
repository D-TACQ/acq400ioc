# AO424 range, init : Master : control only

record (mbbo, "${UUT}:${SITE}:RANGE:ALL") {	
	field(DTYP, "stream")
	field(OUT,  "@ao424.proto setRangeAll ${SPORT}")
	field(NOBT, "3")	
	field(ZRST, "UP5V")
	field(ONST, "UP10V")
	field(TWST, "5V")
	field(THST, "10V")
	field(FRST, "2V5")
	field(FVST, "-2V5/7V5")
	field(FLNK, "${UUT}:${SITE}:RANGE:COMMIT_ALL")
}

record (longout, "${UUT}:${SITE}:INITRAW:ALL") {
	field(DTYP, "stream")
	field(OUT,  "@ao424.proto setInitAll ${SPORT}")
}

record(bo, "${UUT}:${SITE}:RANGE:COMMIT") {
	field(DTYP, "stream")
	field(OUT,  "@ao424.proto setCommit ${SPORT}")
	# save it for the end ..
	field(SDIS, "${UUT}:${SITE}:RANGE:ALL.PACT")
	field(DISV, "1")
}

record(bo, "${UUT}:${SITE}:RANGE:COMMIT_ALL") {
	field(DTYP, "stream")
	field(OUT,  "@ao424.proto setCommit ${SPORT}")
}
record(longout, "${UUT}:${SITE}:PLAYLOOP_LEN") {
	field(DTYP, "Soft Channel")			
	field(FLNK, "${UUT}:${SITE}:PLAYLOOP_LEN:w PP")	
}

#http://www.aps.anl.gov/epics/tech-talk/2010/msg00131.php
# PLL   : setpoint
# PLL:r : readback
# PLL:s : sync
# PLL:w : write

record(longin, "${UUT}:${SITE}:PLAYLOOP_LEN:r") {
	field(DTYP, "stream")
	field(INP,  "@ao424.proto getPlayloopLength ${SPORT}")
	field(SCAN, "1 second")
	field(PINI, "YES")
	field(FLNK, "${UUT}:${SITE}:PLAYLOOP_LEN:s")
}
record(longout, "${UUT}:${SITE}:PLAYLOOP_LEN:s") {
	field(DTYP, "Soft Channel")
	field(DOL,  "${UUT}:${SITE}:PLAYLOOP_LEN:r NPP")
	field(OMSL, "closed_loop")
	field(OUT,  "${UUT}:${SITE}:PLAYLOOP_LEN PP")
	field(FLNK, "${UUT}:${SITE}:PLAY")
}

record(longout, "${UUT}:${SITE}:PLAYLOOP_LEN:w") {
	field(DTYP, "stream")	
	field(OUT,  "@ao424.proto setPlayloopLength ${SPORT}")	
	field(DISV, "1")
	field(SDIS, "${UUT}:${SITE}:PLAYLOOP_LEN:s.PACT")
}

record(bi, "${UUT}:${SITE}:PLAY") {
	field(DTYP, "Soft Channel")
	field(INP,  "${UUT}:${SITE}:PLAYLOOP_LEN:r")
}

record(bi, "${UUT}:${SITE}:ODDS") {
	field(DTYPE, "stream")
	field(INP,   "@ao424.proto getOdds ${SPORT}")
	field(SCAN,  "1 second")
	field(FLNK,  "${UUT}:${SITE}:FIXED_RANGE")
}

record(calc, "${UUT}:${SITE}:FIXED_RANGE") {
	field(INPA, "${UUT}:${SITE}:PLAY")
	field(INPB, "${UUT}:${SITE}:ODDS")
	field(CALC, "A||B")
}