
** EXPERIMENTAL: change the PV PREFIX from $(hostname)
export IOC_HOST=ioc_119

To trace streamdevice operation:
./scripts/set.epics-trace

REAL SPECTRUM:
/mnt/local/sysconfig/epics.sh:
export IOC_PREINIT=./scripts/load.SpecReal
[ -e /dev/shm/window ] || \
	ln -s /usr/local/CARE/hanning-float.bin /dev/shm/window

SPECTRUM NOTES

# try 8K length. Stub window file to allow generated 8K triangle..
# or, ideally substitute an 8K hanning window file.
export SIZE=8192
export EPICS_CA_MAX_ARRAY_BYTES=500000
#[ -e /dev/shm/window ] || \
#    ln -s /usr/local/CARE/hanning-float.bin /dev/shm/window

# for ADC with DATA32 eg ACQ43x, ACQ42x unpacked:
export IOC_PREINIT=./scripts/load.SpecReal32

Without a signal, it looks pretty much the same on plot. Interesting that we seem to have NO 50Hz at all..
DDC:
/mnt/local/sysconfig/epics.sh:
export IOC_PREINIT=./scripts/load.ddc

ATD : ANALOG THRESHOLD DETECT (TRIGGER) : automated
#was export IOC_PREINIT=./scripts/load.anatrg

DTD : DELTA TRIGGER DETECT : automated
#was export IOC_PREINIT=./scripts/load.deltrg


# SOD TIMEOUT : force a SOD capture to run to completion when pulses stop after SECS seconds from first pulse
export SOD_TIMEOUT="SECONDS [FLUSH_COUNT]"  

# allow more than 80 "channels" per module eg for LIA
export ACQ400IOC_IDX_GT32=1

# stop this seq running
export ACQ43X_SET_SAMPLE_RATE=-1

# set a default sample rate
export ACQ43X_SET_SAMPLE_RATE=10000

ACQ1014:
/mnt/local/sysconfig/epics.sh:
export IOC_PREINIT=./scripts/load.acq1014

# interrupt monitor
export LOAD_INTMON=y

# Enable AI records (OFF by default)

/mnt/local/sysconfig/epics.sh:
echo -1 > /etc/acq400/0/OVERSAMPLING


GPG_MON=y # enable gpg_monitor 
#recommended for testing gpg, you can also set it after the event with
# /usr/local/epics/scripts/gpg_monitor 1 

# Clock Monitor. Enabled by default, but can cause issues, disable:
CLOCKMONITOR=0

# OnSetTransient. Ensures Trigger is SET. Not good for new Sample On Demand mode, to disable:
ONSETTRANSIENT=0

# restrict EPICS to localhost. Some folks don't want to see EPICS CA activity on their LAN:
export EPICS_CAS_INTF_ADDR_LIST=localhost

# WF_ACQ_HOST_WINDOW_PER_CHANNEL .. normal is a window per site, to enable per channel:
WF_ACQ_HOST_WINDOW_PER_CHANNEL=y

# JUDGEMENT:
append to /mnt/local/sysconfig/epics.sh
export SIZE=1024
export IOC_PREINIT=./scripts/load.judgement
# for 32 bit (24 bit ADC) :
export IOC_PREINIT=./scripts/load.judgement32

append to /mnt/local/rc.user:
set.site 0 sync_role master 50000
set.site 1 rgm=3,0,1
TLEN=1024
ssb=$(get.site 0 ssb)
blen=$((TLEN*ssb*2))
# set -1, avoid es
set.site 1 RTM_TRANSLEN=$((TLEN-1))
sleep 0.5
echo RTM_TRANSLEN set, now set bufferlen $blen
set.site 0 bufferlen $blen
echo "set bufferlen $blen recorded $(get.site 0 bufferlen)"

echo >> /etc/sysconfig/acq400.conf "export StreamHead_LDI_SOURCE=%s.bq"
#echo >> /etc/sysconfig/acq400.conf "export DemuxBufferShowES=1"
#echo >> /etc/sysconfig/acq400.conf "export DemuxBufferVerbose=1"
echo >> /etc/sysconfig/acq400.conf "export DemuxBufferSize=131072"

echo "STREAM_OPTS=" >> /etc/sysconfig/acq400_streamd.conf

example python app:

[pgm@hoy5 ~]$ export EPICS_CA_ADDR_LIST=acq1001_329
[pgm@hoy5 ~]$ python
Python 3.8.6 (default, Sep 25 2020, 00:00:00) 
[GCC 10.2.1 20200723 (Red Hat 10.2.1-1)] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> import epics
>>> import numpy as np
>>> ramp=np.linspace(0,1,1024)
>>> ramp3=ramp+3
>>> mu01 = epics.PV('acq1001_329:1:JDG:MU:01:V')
>>> mu01.put(ramp)
1
>>> mu01.put(ramp3)
1
>>> 


# PG module: defaults as PG4 (PGx4, CLKOUT, TRG)
# PG5 option:   PGx5,TRG)
DIO482TD_PG5=y


# WAN Environment. CLIENT probably wants to set 
export EPICS_CA_ADDR_LIST=xxx
